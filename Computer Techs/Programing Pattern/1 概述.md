## 1.1 为什么学习代码设计

### 1.1.1 编写高质量的代码

很多软件工程师，甚至一些知名互联网公司的员工编写的代码都不尽如人意。

一方面，在目前很多盲目追求速度和粗放的开发环境下，很多软件工程师并没有太多时间去思考如何写出高质量的代码。另一方面，在“烂”代码的影响和没有人指导的情况下，很多软件工程师不太清楚高质量代码到底什么样。

如何提高编写高质量代码的能力？

首先要有一定的代码设计方面的理论知识储备，理论知识既是前人智慧的结晶，又是解决问题的工具。

### 1.1.2 应对复杂代码的开发

软件开发的难度体现在两个方面：一方面是技术难，代码量不一定大，但要解决的问题比较难；另一方面是复杂，技术不高深，但项目庞大、业务复杂、代码量大和参与开发的人多。

在代码量非常大，复杂性极高时，不仅要求程序可以正确运行，还要求代码易懂且可维护，这时代码设计相关的知识就有用武之地了。

### 1.1.3 程序员的基本功

对于程序员，技术的积累既要有广度，又要有深度。

优秀的开源项目、框架和中间件的代码量都是极大的，为了保证代码的扩展性、灵活性和可维护性等，代码中会使用较多的设计模式和设计原则。

对于阅读框架源码看不懂的问题，其实就是基本功还不够，自身的能力不足以完全看懂这些代码，而基本功指的其实就是**代码设计**相关的知识。另外还有一个问题是，认为自己读懂了，实际上并没有理解代码的精髓。

### 1.1.4 职场发展的必备技能

初级工程师只需要熟练使用框架、开发工具和编程语言，在做几个项目练手，基本上就能应对日常的开发工作。但如果要成长为高级工程师，就必须注重基本功的训练和基础知识的积累。

只有写出高质量的代码，才能担任起项目的整体开发工作，为开发进度、效率和质量负责，避免为团队堆砌垃圾代码，让项目变得难以维护。

## 1.2 如何评价代码质量

对于代码质量的描述，除了“好”和“烂”这样比较简单、笼统的描述方式外，还有很多语义丰富、专业和细化的描述方式：灵活性、可扩展性、可维护性、可读性、可理解性、易修改性、可复用性、可测试性、模块化、高内聚低耦合、高效、高性能、安全性、兼容性、易用性、简洁、清晰、简单、直接、少即是多、文档详尽、分层清晰、正确性、健壮性、鲁棒性、可用性、可伸缩性、稳定性、优雅等。

实际上我们很难只用其中几个词语来全面地评价代码的质量，因为这些词语都是从不同角度来描述代码质量的。不同的评价角度并不是相互独立的，有些存在包含关系、重叠关系等。

另外，对代码质量的评价有很强的主观性，所以其准确度和评价者自身的经验有极大的关系。

下面挑出了7个常用的评价标准作解释。

### 1.2.1 可维护性

代码易维护指的是在不破坏原有代码设计、不引入新的bug的情况下，能够快速地修改或添加代码。

代码不易维护指的是修改或添加代码需要冒极大的引入新bug的风险，并且需要很长时间才能完成。

代码的可维护性也是一个难以量化、偏向对代码整体进行评价的标准，它是由很多因素共同作用的结果，代码简洁、可读性好、可扩展性好，往往就使得代码易维护。

### 1.2.2 可读性

软件设计专家Martin Fowler说过："Any fool can write code that a computer can understand. Good programmers write code that humans can understand."（任何人都可以写出计算机能理解的代码，而好的程序员能够编写人能理解的代码。）

代码的可读性在很大程度上影响代码的可维护性，因为无论是修改还是添加功能代码，首先都要读懂原来的代码，如果对代码一知半解，那么就很有可能引入新的bug。

### 1.2.3 可扩展性

代码的可扩展性是指在不修改或少量修改原有代码的情况下，能够通过扩展方式添加新功能代码。换句话说，代码的可扩展性是指在编写代码时预留了一些功能扩展点，我们可以把新功能代码直接插入扩展点，而不会因为添加新的功能代码而改动大量的原始代码。

### 1.2.4 灵活性

“灵活”是一个抽象的评价标准，很难给它下一个定义。

下面有三种情景帮助理解灵活性。

1. 添加新功能代码时，由于原有代码中预留了扩展点，因此不需要修改原有代码，直接在扩展点上添加新代码。
2. 要实现一个功能时，如果原有代码中已经抽象出了很多位于底层且可以复用的模块、类等，可以直接使用。
3. 使用某个类时，这个类可以应对多种使用场景，满足多种不同需求。

### 1.2.5 简洁性

有一条非常著名的设计原则，KISS（Keep It Simple, Stupid）。意思是尽量保持代码简单，代码简单、逻辑清晰往往意味着代码可读性和可维护性好。

并不是说简单的代码就没有技术含量，而必须要在项目中使用一些复杂的设计模式，以体现技术水平。实际上，思从深而行从简，真正的高手往往能用简单的方法解决复杂的问题。

### 1.2.6 可复用性

可以将代码的可复用性简单理解为“尽量减少重复代码的编写，复用已有代码”。

代码的可复用性和DRY(Don't Repeat Yourself)原则的关系紧密。

### 1.2.7 可测试性

代码的可测试性可以从侧面准确地反映代码质量的高低。

如果代码难以编写单元测试，基本能够说明代码的设计有问题。

## 1.3 如何写出高质量代码

要写出满足上述标准的高质量代码，我们需要掌握一些细化、可落地的编程方法论，包括面向对象设计范式、设计原则、代码规范、重构技巧和设计模式等。

### 1.3.1 面向对象

目前，编程范式或编程风格主要有三种：面向过程、面向对象和函数式编程，其中面向对象是主流。

面向对象因其具有丰富的特性，可以实现很多复杂的设计思路，所以它是很多设计原则、设计模式编码实现的基础。

对于面向对象，需要掌握下面7个知识点。

1. 面向对象的四大特性：封装、抽象、继承、多态。
2. 面向对象和面向过程编程的区别和联系。
3. 面向对象分析、设计、编程。
4. 接口和抽象类的去呗，以及各自的应用场景。
5. 基于接口而非实现编程的设计思想。
6. “多用组合，少用继承”的设计思想。
7. 面向过程的“贫血”模型和面向对象的“充血”模型。

### 1.3.2 设计原则

设计原则是代码设计时的一些经验总结，有一个特点：这些设计原则看起来抽象，定义描述比较模糊，不同的人会有不同的解读。

因此，如果单纯记忆这些设计原则的定义，那么对编程和设计的能力是没有太大帮助的。只有理解和掌握，才能在项目中灵活、恰当地运用设计原则。

对于设计原则，需要掌握以下9种原则。

1. 单一职责原则（SRP）
2. 开闭原则（OCP）
3. 里氏替换原则（LSP）
4. 接口隔离原则（ISP）
5. 依赖倒置原则（DIP）
6. KISS原则、YAGNI原则、DRY原则和LoD法则

### 1.3.3 设计模式

设计模式是针对软件开发中经常遇到的一些设计问题而总结的一套解决方案或设计思路。大部分设计模式解决的是代码解耦、可扩展性问题。

相对于设计原则来说，设计模式没有那么抽象，不难理解，代码实现也并不复杂，对于设计模式，需要重点掌握它们能够解决哪些问题和典型的应用场景，不过度使用。

按类型可以将设计模式分为以下三种：

1. 创建型设计模式：单例模式、工厂模式（简单工厂、工厂方法、抽象工厂）、建造者模式、原型模式。
2. 结构性设计模式：代理模式、装饰器模式、适配器模式、桥接模式、门面模式、组合模式、享元模式。
3. 行为型设计模式：观察者模式、模板方法模式、策略模式、职责链模式、状态模式、迭代器模式、访问者模式、备忘录模式、命令模式、解释器模式、中介模式。

### 1.3.4 代码规范

代码规范解决的主要是代码可读性问题。相对于设计原则和设计模式，代码规范更加具体且偏重代码细节。如果软件工程师开发的项目并不复杂，那么可以不必了解设计原则和掌握设计模式，但起码需要熟练掌握代码规范。

### 1.3.5 重构技巧

在软件开发中，只要软件在不停迭代，就没有一劳永逸的设计。随着需求的变化，代码的不停堆砌，原有设计必定存在问题。针对这些问题，我们需要对代码进行重构，重构是软件开发中的重要环节。持续重构是保持代码质量不下降的有效手段。

重构的工具有面向对象编程范式、设计原则、设计模式和代码规范。

虽然说设计模式可以提高代码的可扩展性，但如果过度、不恰当地使用设计模式，就会增加代码的复杂度，影响可读性。所以在开发初期，除非必要，一定不要过度设计，应用复杂的设计模式，而是当代码出现问题时，再针对问题使用设计原则和设计模式进行重构。

## 1.4 如何避免过度设计

### 1.4.1 代码设计的初衷是提高代码质量

设计模式只是方法，应用它的最终目的是提高代码质量，也就是提高代码的可读性、可扩展性和可维护性等。

因此在做代码设计时，一定要先思考为什么这样设计，为什么要使用这种设计模式，以及这样做是否能真正提高代码质量，能够提高哪方面的质量。如果很难想清楚这些问题，那么基本上可以断定是过度设计了。

### 1.4.2 代码设计的原则是“先有问题，后有方案”

代码设计应该分析代码存在的痛点，再针对性地应用设计模式、设计原则改善代码，而不是盲目地套用某个设计模式和设计原则。

### 1.4.3 代码设计的应用场景是复杂代码

应用设计模式的目的是解耦，也就是利用更好的代码结构，将一大段代码拆分成职责单一的“小”类，让代码满足“高内聚，低耦合”等特性。

设计模式是为了解决复杂代码问题而生的，如果我们开发的代码不复杂，就没必要引入复杂的设计模式。

总之，简单的问题就用简单的方案处理即可，不要将简单问题复杂化。

### 1.4.4 持续重构可有效避免过度设计

持续重构不仅是保证代码质量的重要手段，也是避免过度设计的有效方法。

在真正有痛点的时候再考虑用设计模式来解决，而不是一开始就为不一定实现的未来需求而应用设计模式。

### 1.4.5 不要脱离具体场景谈代码设计

代码设计是一件很主观的事情，其好坏很难评判。如果要评判，那么尽量放到具体的场景中。