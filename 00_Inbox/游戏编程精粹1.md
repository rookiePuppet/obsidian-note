# 通用编程技术

## 在线游戏的网络协议

大多数的加密方案假定一个可信的发送者和一个可信的接收者要通过一个不可信的通道进行通信，但不是所有玩家都是可信任的。

### 定义

协议设计主要针对于有一个或多个不可信客户端和一个可信中央服务器的客户端/服务器类型在线游戏。

客户端和服务器通过网络通道发送可靠或不可靠的报文进行通信。

报文由包含管理信息的包头（header）和包含要进行通信的实际数据的有效负载（payload）组成。

网络协议的目标是将发送者的原始有效负载发送到接收者，所有对有效负载序列的修改都应该被检测到。

### 篡改报文

针对报文篡改的一种防御方式是校验和（checksum），通过组合报文中每个字节得到的一个短数字。

一个完美的校验和算法应该对任意被修改过的报文计算出不同的值。

哈希函数尤其是单向哈希函数能够构造出极好的校验和，MD5算法就是一个经过广泛测试、可公开使用的单向哈希函数。

校验和机制的弱点在于，客户端中包含了计算校验和的代码，攻击者就可以通过逆向工程获取校验和算法，然后对修改过后的报文计算出正确的校验和，再重新发送，这种攻击称为报文重放（packet replay）。

### 报文重放

一个预防报文重放的较好方法是：使用一个状态机为连续的报文生成连续的识别号，一个快速且足够复杂的计算方法是常用于系统库中的线性叠加随机数生成器。

发送者和接收者各自维持一个线性叠加随机数生成器，当发送一个报文时，生成一个随机数添加到报文中，接收者使用自己的随机数生成器检查报文中的随机数是否匹配，如果不匹配则说明报文被篡改。

该策略的复杂之处在于如何初始化以及同步状态机。
